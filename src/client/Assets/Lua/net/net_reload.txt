local require = require
local print = print
local typeof = typeof

local character_manager = require "character_manager"
local msg_pb = require "msg_pb"
local config_datas = require "config_datas"
local bullet = require "bullet"
local math = require "math"
local net = require "net"
local action_pb = require "action_pb"
local common_pb = require "common_pb"
local effect = require "effect_pb"
local prop_pb = require "prop_pb"

local Vector3 = CS.UnityEngine.Vector3
local GameObject = CS.UnityEngine.GameObject
local GameObjectPool = CS.War.Base.GameObjectPool
local RES_TYPE = CS.War.Base.RES_TYPE
local util = require "util"

local HitActionType = typeof(CS.War.Game.HitAction)
local CharacterEntityType = typeof(CS.War.Game.CharacterEntity)
local ObjectToMoveType = typeof(CS.War.Scene.ObjectToMove)
local World = CS.War.Script.World
local BodyPart = CS.War.Game.BodyPart
local AkSoundEngineLua = CS.War.Script.AkSoundEngineLua

module("net_reload")

function SendStartReloadActionMSG(char, currentWeapon)
	if char == nil or currentWeapon == nil then
		return
	end
	local ware = char:GetWare(prop_pb.WAREINDEX_EQUIP)
	local good = ware:GetItem(currentWeapon.slotIdx + prop_pb.EQUIPPLACE_P_WEAPON)
	if good == nil then
		return
	end
	local sid = good.goodsSid
	local reloadBulletMsg = action_pb.TMAG_ACTION_WEAPON_RELOAD()
	reloadBulletMsg.motionType = common_pb.Reload_Motion
	reloadBulletMsg.gunSid = sid
	reloadBulletMsg.bulletNum = 0
	net.SendMessage(net.Endpoint_Client, net.Endpoint_Zone, net.Module_Action, msg_pb.MAG_ACTION_WEAPON_RELOAD, reloadBulletMsg)
end

function SendFinishReloadActionMSG(char, currentWeapon)
	if char == nil or currentWeapon == nil then
		return
	end
	local ware = char:GetWare(prop_pb.WAREINDEX_EQUIP)
	local good = ware:GetItem(currentWeapon.slotIdx + prop_pb.EQUIPPLACE_P_WEAPON)
	if good == nil then
		return
	end
	local sid = good.goodsSid
	local reloadBulletMsg = action_pb.TMAG_ACTION_WEAPON_RELOAD()
	reloadBulletMsg.motionType = common_pb.Reload_Really
	reloadBulletMsg.gunSid = sid
	reloadBulletMsg.bulletNum = 0
	net.SendMessage(net.Endpoint_Client, net.Endpoint_Zone, net.Module_Action, msg_pb.MAG_ACTION_WEAPON_RELOAD, reloadBulletMsg)
end


